<UserControl x:Class="DANCustomTools.Views.ActorCreateView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:converters="clr-namespace:DANCustomTools.Converters"
             xmlns:controls="clr-namespace:DANCustomTools.Controls"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="400"
             Background="{StaticResource GameEditorBackgroundBrush}"
             FontFamily="Segoe UI">

    <UserControl.Resources>
        <converters:ObjectToBoolConverter x:Key="ObjectToBoolConverter"/>
        <converters:CountToVisibilityConverter x:Key="CountToVisibilityConverter"/>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </UserControl.Resources>

    <materialDesign:Card Style="{StaticResource GameEditorCardStyle}" Margin="4">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <Border Grid.Row="0"
                    Background="{StaticResource GameEditorHeaderBrush}"
                    Padding="16,12">
                <DockPanel>
                    <materialDesign:PackIcon Kind="Account"
                                             Width="22" Height="22"
                                             VerticalAlignment="Center"
                                             Foreground="White"
                                             DockPanel.Dock="Left"/>
                    <TextBlock Text="Actor Creator"
                               FontSize="16"
                               FontWeight="SemiBold"
                               Foreground="White"
                               VerticalAlignment="Center"
                               Margin="12,0,0,0"
                               DockPanel.Dock="Left"/>

                    <!-- Connection Status -->
                    <StackPanel Orientation="Horizontal"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Center"
                                DockPanel.Dock="Right">
                        <Ellipse Width="8" Height="8"
                                 Margin="0,0,6,0"
                                 VerticalAlignment="Center">
                            <Ellipse.Style>
                                <Style TargetType="Ellipse">
                                    <Setter Property="Fill" Value="{StaticResource GameEditorWarningBrush}"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsConnected}" Value="True">
                                            <Setter Property="Fill" Value="{StaticResource GameEditorSuccessBrush}"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Ellipse.Style>
                        </Ellipse>
                        <TextBlock Text="Online"
                                   FontSize="11"
                                   FontWeight="Medium"
                                   Foreground="White"
                                   VerticalAlignment="Center"
                                   Opacity="0.9"/>
                    </StackPanel>
                </DockPanel>
            </Border>

            <!-- Main Content - Split Layout -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="1*" MinWidth="300"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="1.5*" MinWidth="400"/>
                </Grid.ColumnDefinitions>

                <!-- Left Panel - Actor Management -->
                <ScrollViewer Grid.Column="0" VerticalScrollBarVisibility="Auto" Margin="8,8,4,8">
                    <StackPanel>
                        <!-- Action Buttons -->
                        <WrapPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,16">
                            <Button Style="{StaticResource GameEditorToolButtonStyle}"
                                    Command="{Binding LoadActorCommand}"
                                    CommandParameter="{Binding SelectedActor}"
                                    ToolTip="Load Selected Actor"
                                    Margin="2">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="FolderOpen" Width="14" Height="14" Margin="0,0,6,0"/>
                                    <TextBlock Text="Load" FontSize="11"/>
                                </StackPanel>
                            </Button>

                            <Button Style="{StaticResource GameEditorToolButtonStyle}"
                                    Command="{Binding SaveActorCommand}"
                                    ToolTip="Save Actor"
                                    Margin="2">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="ContentSaveOutline" Width="14" Height="14" Margin="0,0,6,0"/>
                                    <TextBlock Text="Save" FontSize="11"/>
                                </StackPanel>
                            </Button>

                            <Button Style="{StaticResource GameEditorToolButtonStyle}"
                                    Command="{Binding RefreshCommand}"
                                    ToolTip="Refresh"
                                    Margin="2">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Refresh" Width="14" Height="14" Margin="0,0,6,0"/>
                                    <TextBlock Text="Refresh" FontSize="11"/>
                                </StackPanel>
                            </Button>
                        </WrapPanel>

                        <!-- New Actor Creation -->
                        <GroupBox Header="Create New Actor" Margin="0,0,0,16" FontSize="12">
                            <StackPanel>
                                <TextBox Text="{Binding NewActorName}"
                                         materialDesign:HintAssist.Hint="Enter actor name"
                                         FontSize="11"
                                         Margin="0,0,0,8"/>
                                <Button Style="{StaticResource GameEditorToolButtonStyle}"
                                        Command="{Binding CreateNewActorCommand}"
                                        HorizontalAlignment="Left">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Plus" Width="14" Height="14" Margin="0,0,6,0"/>
                                        <TextBlock Text="Create Actor" FontSize="11"/>
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </GroupBox>

                        <!-- Actor List -->
                        <GroupBox Header="Actors" FontSize="12">
                            <Grid>
                                <ListBox ItemsSource="{Binding ActorList}"
                                         SelectedItem="{Binding SelectedActor}"
                                         Height="200">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal" Margin="6,3">
                                                <materialDesign:PackIcon Kind="Account"
                                                                         Width="14" Height="14"
                                                                         Margin="0,0,8,0"
                                                                         VerticalAlignment="Center"/>
                                                <StackPanel>
                                                    <TextBlock Text="{Binding Name}"
                                                               FontWeight="SemiBold"
                                                               FontSize="11"/>
                                                    <TextBlock Text="{Binding ComponentList.Count, StringFormat='Components: {0}'}"
                                                               FontSize="10"
                                                               Opacity="0.7"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                    <ListBox.ItemContainerStyle>
                                        <Style TargetType="ListBoxItem">
                                            <Setter Property="Padding" Value="4"/>
                                            <EventSetter Event="MouseDoubleClick" Handler="ActorItem_MouseDoubleClick"/>
                                        </Style>
                                    </ListBox.ItemContainerStyle>
                                </ListBox>

                                <!-- Empty State -->
                                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                    <StackPanel.Style>
                                        <Style TargetType="StackPanel">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding ActorList.Count}" Value="0">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </StackPanel.Style>
                                    <materialDesign:PackIcon Kind="EmoticonSad" Width="32" Height="32"/>
                                    <TextBlock Text="No actors found" FontSize="12" Margin="0,4,0,0"/>
                                </StackPanel>
                            </Grid>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>

                <!-- Splitter -->
                <GridSplitter Grid.Column="1"
                              Width="4"
                              Background="{StaticResource GameEditorAccentBrush}"
                              VerticalAlignment="Stretch"
                              ResizeDirection="Columns"/>

                <!-- Right Panel - Component Management & Properties -->
                <Grid Grid.Column="2" Margin="4,8,8,8">
                    <TabControl>
                        <TabItem Header="Components">
                            <controls:ComponentListView DataContext="{Binding ComponentListViewModel}"/>
                        </TabItem>
                        <TabItem Header="Properties">
                            <controls:XmlPropertyGrid DataContext="{Binding XmlPropertyGridViewModel}"/>
                        </TabItem>
                    </TabControl>
                </Grid>
            </Grid>

            <!-- Status Bar -->
            <Border Grid.Row="2"
                    Background="{DynamicResource MaterialDesignDivider}"
                    Padding="16,8">
                <DockPanel>
                    <!-- Loading Indicator -->
                    <ProgressBar DockPanel.Dock="Left"
                                 Width="16" Height="16"
                                 IsIndeterminate="True"
                                 Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}"
                                 Margin="0,0,8,0"/>

                    <!-- Status Message -->
                    <TextBlock Text="{Binding StatusMessage}"
                               FontSize="12"
                               Foreground="{DynamicResource MaterialDesignBody}"
                               VerticalAlignment="Center"/>
                </DockPanel>
            </Border>

        </Grid>
    </materialDesign:Card>
</UserControl>